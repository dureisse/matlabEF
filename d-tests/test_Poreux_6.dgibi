* On teste le 3D sur un cylindre
LTRAC1 = VRAI;
LTRAC1 = FAUX;

*
* Geometrie
*
RAY1 = 0.5; RAY2 = 0.8; N1 = 2; N2 = 3; N3 = 3;
RAY1 = 0.5; RAY2 = 0.8; N1 = 4; N2 = 6; N3 = 5;
*RAY1 = 0.5; RAY2 = 0.8; N1 = 8; N2 = 12; N3 = 10;

OPTI DIME 2 ELEM TRI3;
O1 = 0. 0.; P1 = RAY1 0.; P2 = 0. RAY1;
Q1 = RAY2 0.; Q2 = 0. RAY2;
CE1 = CERC N2 P1 O1 P2;
CE2 = CERC N2 Q2 O1 Q1;
CONT1 = (P1 D N1 Q1) ET CE2 ET (Q2 D N1 P2) ET CE1;
MAIL1 = CONT1 SURF PLAN;

OPTI DIME 3 ELEM TET4;
HAU1 = 1.; 
R1 = 0. 0. HAU1;
MAILT1 = MAIL1 VOLU TRAN N3 R1;
MAILT1 = MAILT1 CHAN TET4;

MAIL2 = MAIL1 PLUS R1;
ELIM (MAIL2 ET MAILT1) 0.0001;

NMAILT1 = MAILT1 CHAN POI1;
NN1 = NMAILT1 POINT PLAN O1 P1 (P1 PLUS R1) 0.0001;
NN2 = NMAILT1 POINT PLAN O1 P2 (P2 PLUS R1) 0.0001;
NN3 = NMAILT1 POINT CYLI O1 (O1 PLUS R1) P1 0.0001;
NN4 = NMAILT1 POINT CYLI O1 (O1 PLUS R1) Q1 0.0001;
CMAILT1 = ENVEL MAILT1;
FAC1 = CMAILT1 ELEMENT APPUYE STRICTEMENT NN1;
FAC2 = CMAILT1 ELEMENT APPUYE STRICTEMENT NN2;
INT1 = CMAILT1 ELEMENT APPUYE STRICTEMENT NN3;
EXT1 = CMAILT1 ELEMENT APPUYE STRICTEMENT NN4;

SI (LTRAC1);
trac mailt1 cach;
trac int1;
trac ext1;
FINSI;

* Materiau
* module d'Young YOUN1
YOUN1 = 20.;
* coefficient de Poisson YNU1
YNU1 = 0.2;
* coefficient de "permeabilite" YH1 (3.6E-13 SI)
YH1 = 566.6666;
* coefficient de compressibilite YK1 (7.716E8 Pa)
* ou module de Biot
YK1 = 17.536;
YK1 = 17.536e5;
* coefficient de Biot (couplage)
CBIOT1 = 0.78;

* Temps caracteristique pression
tauF = (1./YH1)*((1./YK1) + (CBIOT1*CBIOT1/YOUN1)) *
       (((RAY2-RAY1)/PI) ** 2);
MESS 'TEMPS CARACTERISTIQUE' tauF;

* CL Solides
* On bloque UZ en haut et en bas
CC1 = MANU CHPO (MAIL1 ET MAIL2) 1 'UD1' 1. NATURE DISCRET;
* On bloque UY sur la face 1, UX sur la face 2
CC1 = CC1 ET (MANU CHPO FAC1 1 'UD2' 1. NATURE DISCRET);
CC1 = CC1 ET (MANU CHPO FAC2 1 'UD3' 1. NATURE DISCRET);
* Force imposee sur la face interieure
PRES1 = 1.;
MODL1 = MODE MAILT1 MECANIQUE ELASTIQUE;
FEXT1 = PRES MASS MODL1 INT1 PRES1;
CC1 = CC1 ET FEXT1;
SI (LTRAC1);
  V1 = VECT CC1 FX FY FZ VERT;
  TRAC V1 (ENVE MAILT1);
FINSI;

* CL fluides
* Pression imposee sur la face interieure et exterieure
CC1 = CC1 ET (MANU CHPO INT1 2 'PD' 1. 'P1' PRES1 NATURE DISCRET);
CC1 = CC1 ET (MANU CHPO EXT1 2 'PD' 1. 'P1' 0. NATURE DISCRET);

SI (LTRAC1);
TRAC (EXCO UD1 CC1) MAILT1;
TRAC (EXCO UD2 CC1) MAILT1;
TRAC (EXCO UD3 CC1) MAILT1;
TRAC (EXCO PD CC1) MAILT1;
TRAC (EXCO 'P1' CC1) MAILT1;
TRAC (EXCO FX CC1) MAILT1;
TRAC (EXCO FY CC1) MAILT1;
TRAC (((EXCO FX CC1) ** 2) + ((EXCO FY CC1) ** 2)) MAILT1;
FINSI;

  MAT1 = MANU CHML MODL1 YOUN YOUN1 NU YNU1
          MOB YK1 COB CBIOT1 PERM YH1 VISC 1. GRAVITE;

X1 Y1 Z1 = COOR MAILT1;
CC1 = CC1 ET 
(EXCO SCAL ((X1 ** 2) + (Y1 ** 3)) UX NATURE DISCRET) ET
(EXCO SCAL ((X1 ** 0.5) + (Z1 ** 2)) UY NATURE DISCRET);
CC1 = CC1 ET (EXCO SCAL ((X1 - Y1) ** 2) UZ NATURE DISCRET);

MATR1 = MATE MODL1 YOUN YOUN1 NU YNU1;
RIGI1 = RIGI MODL1 MATR1;
XVAL1 = XTMX CC1 RIGI1;
list xval1;
*list (xval1 - 20.204634356);
list (xval1 - 23.625327804);


NM1 = CHAN MAILT1 POI1;
X1 = CHAN X1 ATTRIBUT NATURE DISCRET;
Y1 = CHAN Y1 ATTRIBUT NATURE DISCRET;
MY1 = MANU CHPO (NM1 DIFF (CHAN FAC1 POI1)) 1 SCAL 1. NATURE DISCRET;
MX1 = MANU CHPO (NM1 DIFF (CHAN FAC2 POI1)) 1 SCAL 1. NATURE DISCRET;
MZ1 = MANU CHPO (NM1 DIFF (CHAN (MAIL1 ET MAIL2) POI1))
      1 SCAL 1. NATURE DISCRET;
JUNK1 = 
((EXCO SCAL ((X1 ** 2) + (Y1 ** 3)) UX NATURE DISCRET) * MX1);
JUNK2 =
((EXCO SCAL ((X1 ** 0.5) + (Z1 ** 2)) UY NATURE DISCRET) * MY1);
JUNK3 = (EXCO SCAL ((X1 - Y1) ** 2) UZ NATURE DISCRET) * MZ1;
CC2 = (CHAN JUNK1 ATTRIBUT NATURE DISCRET) ET
(CHAN JUNK2 ATTRIBUT NATURE DISCRET) ET
(CHAN JUNK3 ATTRIBUT NATURE DISCRET);

*TRAC (EXCO CC2 UX) MAILT1;
*TRAC (EXCO CC2 UY) MAILT1;
XVAL2 = XTMX CC2 RIGI1;
list xval2;
*list (xval2 - 142.616234162);
list (xval2 - 148.315143711787);

RIGIT1 = RIGI1 ET (BLOQ UY FAC1) ET (BLOQ UX FAC2) ET
        (BLOQ UZ (MAIL1 ET MAIL2));
DEPL1 = RESO RIGIT1 FEXT1;
DEFO1 = DEFO DEPL1 MAILT1;
SI (LTRAC1);
  TRAC DEFO1 MAILT1 CACH;
FINSI;
CC1 = CC1 ET (EXCO UX DEPL1 UX1 NATURE DISCRET) ET
             (EXCO UY DEPL1 UY1 NATURE DISCRET) ET
             (EXCO UZ DEPL1 UZ1 NATURE DISCRET);
XX = (((EXCO UX DEPL1 SCAL NATURE DISCRET) ** 2) +
     ((EXCO UY DEPL1 SCAL NATURE DISCRET) ** 2) +
     ((EXCO UZ DEPL1 SCAL NATURE DISCRET) ** 2)) ** 0.5;
SI (LTRAC1);
  TRAC XX MAILT1;
FINSI;

opti sort 'test_Poreux_6';
sort avs mailt1 CC1 mat1;
opti sort 'poub';

fin;

