* Treillis de barres

OPTI DIME 2 ELEM TRI3;
OPTI MODE PLAN CONT;

LTRAC1 = FAUX;

P1 = 0. 0.; P2 = 1. 0.; P3 = 1. 1.; P4 = 0. 1.;
NB1 = 9; 
A1 = P1 D NB1 P2;
A3 = P2 D NB1 P3;
A4 = P3 D (NB1 - 1) P4;
A2 = P4 D (NB1 - 1) P1;
CONT1 = A1 ET A2 ET A3 ET A4;
M1 = CONT1 SURF PLAN;
M1 = M1 CHAN LIGNE;
* A1 UY=0   A2 UX>0   A3 UX=0  A4 F=0
MAIL1 = M1;
MODL1 = MODE M1 MECANIQUE ELASTIQUE BARR;
CC2 = MANU CHML MODL1 YOUN 1. NU 0.3 SECT 1. GRAVITE;

SI (LTRAC1); TRAC M1; FINSI;

OPTI SORT 'test_Barr_2';
SORT AVS MAIL1 CC2 SUIT;

UD1 = MANU CHPO A1 1 UY 0. NATURE DIFFUS;
UD2 = MANU CHPO A2 1 UX 0. NATURE DIFFUS;
UD3 = MANU CHPO A3 1 UX 0. NATURE DIFFUS;
FD1 = MANU CHPO A4 2 FX 0. FY 1. NATURE DISCRET;

SORT AVS FD1 SUIT;
SORT AVS UD1 SUIT;
UDD2 = UD2 ET UD3;
SORT AVS UDD2 SUIT;

MATR1 = MATE MODL1 YOUN (EXCO YOUN CC2) NU (EXCO NU CC2)
  SECT (EXCO SECT CC2);
RIGI1 = RIGI MODL1 MATR1;
BLOQ1 = BLOQ A1 UY;
BLOQ2 = BLOQ (A2 ET A3) UX;
RIGIT1 = RIGI1 ET BLOQ1 ET BLOQ2;
DEPI1 = DEPI BLOQ1 UD1;
DEPI2 = DEPI BLOQ2 UDD2;
FEXTT1 = FD1 ET DEPI1 ET DEPI2;
DEPL1 = RESO RIGIT1 FEXTT1;

DEPL2 = (EXCO UX DEPL1 UX) ET (EXCO UY DEPL1 UY);

DEFO0 = DEFO DEPL2 M1 0.;
DEFO1 = DEFO DEPL2 M1 0.2 ROUG;
SI (LTRAC1); TRAC (DEFO0 ET DEFO1); FINSI;

SORT AVS DEPL2 SUIT;
OPTI SORT 'poub';

XVAL1 =  XTMX DEPL2 RIGI1;
MESS 'XVAL1' XVAL1;
list (xval1 - 7.1038220528);

FIN;

SI (LTRAC1);
* On compare les solutions
OPTI LECT 'resu_treillis.avs';
I1 = 0; REPETE BLOI1 NSDMT1; I1 = I1 + 1;
  TAB1 = LIRE AVS;
  MAIL1 = TAB1 . 'LEMAILLA';
  CHPO1 = TAB1 . 'LECHPOIN';
*si (ega i1 1);
*  el1 = (elem mail1 SEG2) elem 4;
*finsi;
  SI (EGA I1 1); MAILT1 = MAIL1; CHPOT1 = CHPO1;
  SINON; MAILT1 = MAILT1 ET MAIL1; CHPOT1 = CHPOT1 ET CHPO1;
  FINSI;
FIN BLOI1;
OPTI DIME 2;
DEFO0M = DEFO CHPOT1 MAILT1 0. BLANC;
DEFO1M = DEFO CHPOT1 MAILT1 0.2 BLEU;
TRAC (DEFO0M ET DEFO1M ET DEFO1);

MODL1 = MODL MAILT1 MECANIQUE ELASTIQUE BARRE;
MATR1 = MATE MODL1 YOUN 1. NU 0.3 SECT 1.;
SIG1 = SIGMA MODL1 MATR1 CHPOT1; 
FF1 = BSIG SIG1 MODL1 MATR1; 
VV1 = vect FF1 FX FY 0.05;
TRAC VV1 (M1 ET MAILT1);

opti donn 5;
FINSI;

fin;



* Relecture data
LCOL1 = TABLE;
LCOL1 . 1 = 'BLEU';
LCOL1 . 2 = 'ROUG';
LCOL1 . 3 = 'ROSE';
LCOL1 . 4 = 'JAUN';
LCOL1 . 5 = 'VERT';
LCOL1 . 6 = 'TURQ';
LCOL1 . 7 = 'BLAN';
OPTI LECT 'resu_treillis.avs';
NINT1 = 11;
I1 = 0; REPETE BLO1 (NSDMT1 + NINT1); I1 = I1 + 1;
  TAB1 = LIRE AVS;
  MAIL1 = TAB1 . LEMAILLA;
  J1 = (I1 - 1) - (((I1 - 1) / 7) * 7) + 1;
  MAIL1 = COUL MAIL1 LCOL1.J1;
  G1 = BARY MAIL1;
  DEPL MAIL1 PLUS (0.2 * G1);
  SI (EGA I1 1); MAILT1 = MAIL1;
  SINON; MAILT1 = MAILT1 ET MAIL1;
  FINSI;
FIN BLO1;
OPTI DIME 2;
TRAC MAILT1;


